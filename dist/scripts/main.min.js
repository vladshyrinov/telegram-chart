"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var Chart=function(){function Chart(_initChartData){_classCallCheck(this,Chart),this.chartData=_initChartData.chartData,this.entryPoint=_initChartData.entryPoint,this.axisOptions=_initChartData.axis,this.chartNameOptions=_initChartData.chartName,this.chartDrawingOptions=_initChartData.chartDrawingOptions,this.generalChartDrawingOptions=_initChartData.generalChartDrawingOptions,this.detailedInfoOptions=_initChartData.detailedInfo,this.mode=0}return _createClass(Chart,[{key:"startUp",value:function(){this._setDOMElementsNodes(this.entryPoint),this._initSharedCtx(this.entryPoint),this._getColors(),this._initializeChartDrawing(this.chartDrawingOptions,this.detailedCtx,this._getRange()),this._initializeChartDrawing(this.generalChartDrawingOptions,this.generalCtx),this._setCheckBoxesClickEvent(),this._setDragHandler(),this._setSwitchModeListener(),this._setDetailedInfoListener(this.detailedCanvas,this.chartDrawingOptions)}},{key:"_getRange",value:function(reverse){var endHiddenPercentage,startHiddenPercentage,startIndex,endIndex,dataLength=this.chartData.columns[0].length-1,shownPercentage=+((this.windowSizer.clientWidth-2*this.sizerRight.clientWidth)/this.windowSizerWrapper.clientWidth).toFixed(2),valuesAmount=Math.round(dataLength*shownPercentage);return reverse?(endHiddenPercentage=(this.windowSizerWrapper.getBoundingClientRect().right-this.windowSizer.getBoundingClientRect().right+this.sizerRight.clientWidth)/this.windowSizerWrapper.clientWidth,startIndex=(endIndex=Math.ceil(dataLength*(1-endHiddenPercentage))-1)-valuesAmount+1):(startHiddenPercentage=(this.windowSizer.getBoundingClientRect().left-this.windowSizerWrapper.getBoundingClientRect().left+this.sizerRight.clientWidth)/this.windowSizerWrapper.clientWidth,endIndex=(startIndex=Math.ceil(dataLength*startHiddenPercentage)+1)+valuesAmount-1),[startIndex,endIndex]}},{key:"_getColors",value:function(){this.colors={lightgreen:"#3cc23f",lightgray:"#E6ECF0",white:"#ffffff",black:"#000000",brightblue:"#108BE3",nightblue:"#242F3E",bluishgray:"#334557",transparent:"transparent"}}},{key:"_initSharedCtx",value:function(entryPoint){this.detailedCanvas=document.querySelector("".concat(entryPoint," .detailed-chart")),this.detailedCtx=this.detailedCanvas.getContext("2d"),this.generalCanvas=document.querySelector("".concat(entryPoint," .chart")),this.generalCtx=this.generalCanvas.getContext("2d")}},{key:"_setDOMElementsNodes",value:function(entryPoint){document.querySelector(entryPoint).innerHTML=this._initHTMLMarkup,this.windowSizerWrapper=document.querySelector("".concat(entryPoint," .window-sizer-wrapper")),this.windowSizer=document.querySelector("".concat(entryPoint," .window-sizer")),this.sizerRight=document.querySelector("".concat(entryPoint," .sizer-right"))}},{key:"_drawCoordinateAxis",value:function(options,ctx){var offsetX=isNaN(options.offsetX)?10:options.offsetX,offsetY=isNaN(options.offsetY)?10:options.offsetY,chartWidth=isNaN(options.chartWidth)?110:options.chartWidth,chartHeight=isNaN(options.chartHeight)?110:options.chartHeight,xMax=isNaN(options.xMax)?10:options.xMax,xMin=isNaN(options.xMin)?10:options.xMin,yMax=isNaN(options.yMax)?10:options.yMax,yMin=isNaN(options.yMin)?10:options.yMin,stepsX=isNaN(options.stepsX)?5:options.stepsX,stepsY=isNaN(options.stepsY)?5:options.stepsY,stepXValue=(xMax-xMin)/stepsX,stepYValue=yMax/stepsY,startPosX=offsetX-1,endPosX=chartWidth-1,startPosY=chartHeight-1,endPosY=offsetY-1,stepXAxis=(endPosX-startPosX)/stepsX,stepYAxis=(startPosY-endPosY)/stepsY;ctx.save(),ctx.beginPath(),ctx.lineWidth=options.lineWidth||1,ctx.strokeStyle=options.axisColor||this.colors.black,ctx.fillStyle=options.fontColor||this.colors.black,ctx.font=options.font||"8px sans-serif";for(var curPosX=startPosX,curXValue=xMin;curPosX<=endPosX;curPosX+=stepXAxis,curXValue+=stepXValue){var date=new Date(curXValue),representativeDate=this._getRepresentationDate(date);ctx.fillText(representativeDate,curPosX+5,startPosY-5)}for(var curPosY=startPosY,curYValue=yMin;endPosY<=curPosY;curYValue+=stepYValue,curPosY-=stepYAxis){var amount=Math.ceil(curYValue);ctx.moveTo(startPosX,curPosY),ctx.lineTo(endPosX,curPosY),ctx.fillText(amount,startPosX-2,curPosY-6)}ctx.stroke(),ctx.restore()}},{key:"_drawLine",value:function(options,ctx){var xValues,yValues,offsetX=isNaN(options.offsetX)?0:options.offsetX,offsetY=isNaN(options.offsetY)?0:options.offsetY;xValues=options.xValues||[2,6,10],yValues=options.yValues||[2,6,10];var chartWidth=isNaN(options.chartWidth)?110:options.chartWidth,chartHeight=isNaN(options.chartHeight)?110:options.chartHeight,xMax=isNaN(options.xMax)?10:options.xMax,xMin=isNaN(options.xMin)?10:options.xMin,yMax=isNaN(options.yMax)?10:options.yMax,yMin=isNaN(options.yMin)?10:options.yMin,idx=options.idx,stepY=(chartHeight-offsetY-1)/(yMax-yMin),stepX=(chartWidth-offsetX-1)/(xMax-xMin);ctx.save(),ctx.beginPath(),ctx.strokeStyle=options.lineColor||this.colors.black,ctx.lineWidth=options.lineWidth||2;for(var i=0;i<yValues.length;i++){var y=chartHeight-Math.round(stepY*(yValues[i]-yMin)),x=offsetX+Math.round(stepX*(xValues[i]-xMin)),yValue=yValues[i],xValue=xValues[i];ctx===this.detailedCtx&&(this.coordsValuesAccordance["".concat(x,"-").concat(idx)]={x:x,y:y,yValue:yValue,xValue:xValue}),0!==i?ctx.lineTo(x,y):ctx.moveTo(x,y)}ctx.stroke(),ctx.restore()}},{key:"_drawChartName",value:function(options,ctx){var title=options.title||"",offsetX=options.offsetX||10,offsetY=options.offsetY||10;ctx.save(),ctx.font=options.font||"20px sans-serif";var fontColor=options.dayMode.fontColor;this.mode&&(fontColor=options.nightMode.fontColor),ctx.fillStyle=fontColor||this.colors.black,ctx.fillText(title,offsetX,offsetY/2),ctx.restore()}},{key:"_initializeLabelsData",value:function(options){var _this=this,labels=options.labels,colors=Object.values(this.chartData.colors),lineNames=Object.values(this.chartData.names),lineSymbols=Object.keys(this.chartData.names);labels.forEach(function(label,i){var labelOptions={lineName:lineNames[i],color:colors[i],idx:i,lineSymbol:lineSymbols[i]};_this._setLabelParameters(label,labelOptions)})}},{key:"_setLabelParameters",value:function(label,options){label.querySelector(".checkmark").style.borderColor=options.color||this.colors.lightgreen;var checkedCheckmark=label.querySelector("input[type=checkbox]:checked + .checkmark");checkedCheckmark&&(checkedCheckmark.style.backgroundColor=options.color||this.colors.lightgreen),label.querySelector(".category-name").innerText=options.lineName||"Not Set",label.querySelector("input").setAttribute("data-line-symbol",options.lineSymbol)}},{key:"_initializeChartDrawing",value:function(options,ctx,range,detInfoData){var columns=this.chartData.columns,linesColors=this.chartData.colors,linesNames=this.chartData.names,columnsTypes=this.chartData.types,detailedChart=!1!==options.detailedChart,yColumns=[],allYValues=[],xValues=[],labelsDataOptions={labels:Array.from(document.querySelectorAll("".concat(this.entryPoint," .checkboxes-container label")))};this._initializeLabelsData(labelsDataOptions);var activeLines=this._getActiveLinesFromCheckBoxes(),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=columns[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var c=_step.value,lineSymbol=c[0];"x"===columnsTypes[lineSymbol]&&(xValues=range?c.slice(range[0],range[1]+1):c.slice(1)),"line"===columnsTypes[lineSymbol]&&activeLines.includes(lineSymbol)&&(yColumns.push(c),allYValues=[].concat(_toConsumableArray(allYValues),_toConsumableArray(range?c.slice(range[0],range[1]+1):c.slice(1))))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}allYValues.length||(allYValues=[0]);var xyMaxMins={xMax:Math.max.apply(Math,_toConsumableArray(xValues)),xMin:Math.min.apply(Math,_toConsumableArray(xValues)),yMax:Math.max.apply(Math,_toConsumableArray(allYValues)),yMin:0};range&&(this.coordsValuesAccordance={});var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=yColumns.entries()[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _step2$value=_slicedToArray(_step2.value,2),idx=_step2$value[0],_c=_step2$value[1],_lineSymbol=_c[0];if(activeLines.includes(_lineSymbol)){var yValues=void 0;yValues=range?_c.slice(range[0],range[1]+1):_c.slice(1);var lineOptions={lineColor:linesColors[_lineSymbol],name:linesNames[_lineSymbol],xValues:xValues,yValues:yValues,idx:idx};this._drawLine(_objectSpread({},options,xyMaxMins,lineOptions),ctx)}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}detailedChart&&(this._drawCoordinateAxis(_objectSpread({},options,xyMaxMins,this.axisOptions),ctx),this._drawChartName(_objectSpread({},options,this.chartNameOptions),ctx),detInfoData&&this._drawDetailedInfo(ctx,detInfoData,_objectSpread({},options,this.detailedInfoOptions)))}},{key:"_redrawDetailedChart",value:function(reverse,detInfoData){this.detailedCtx.clearRect(0,0,this.detailedCanvas.width,this.detailedCanvas.height);var range=this._getRange(reverse);this._initializeChartDrawing(this.chartDrawingOptions,this.detailedCtx,range,detInfoData)}},{key:"_redrawGeneralChart",value:function(){this.generalCtx.clearRect(0,0,this.generalCanvas.width,this.generalCanvas.height),this._initializeChartDrawing(this.generalChartDrawingOptions,this.generalCtx)}},{key:"_setCheckBoxesClickEvent",value:function(){var _this2=this;Array.from(document.querySelectorAll("".concat(this.entryPoint," .checkboxes-container label"))).forEach(function(label){label.querySelector("input").addEventListener("click",function(e){e.target.nextElementSibling.style.backgroundColor=_this2.colors.transparent,_this2._redrawDetailedChart(),_this2._redrawGeneralChart()},!1)})}},{key:"_getRepresentationDate",value:function(ms,weekDay){var date=new Date(ms),day=date.getDate(),monthAndDay=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][date.getMonth()]+" "+day;return weekDay?(weekDay=["Sun","Mon","Tue","Wed","Thr","Fri","Sat"][date.getDay()])+", "+monthAndDay:monthAndDay}},{key:"_getActiveLinesFromCheckBoxes",value:function(){var checkboxes=Array.from(document.querySelectorAll("".concat(this.entryPoint," .checkboxes-container label input"))),lines=[];return checkboxes.forEach(function(checkbox){checkbox.checked&&lines.push(checkbox.dataset.lineSymbol)}),lines}},{key:"_sizerMoveHandler",value:function(touch,event){var _this3=this;event.preventDefault();var target=event.target,clientX=isNaN(event.clientX)?event.touches[0].clientX:event.clientX,shiftXLeft=clientX-this.windowSizer.getBoundingClientRect().left,shiftXRight=this.windowSizer.getBoundingClientRect().right-clientX,onMove=function(event){var clientX=isNaN(event.clientX)?event.touches[0].clientX:event.clientX;if(target===_this3.windowSizer){var newLeft=clientX-shiftXLeft-_this3.windowSizerWrapper.getBoundingClientRect().left;newLeft<0&&(newLeft=0);var rightEdge=_this3.windowSizerWrapper.offsetWidth-_this3.windowSizer.offsetWidth;rightEdge<newLeft&&(newLeft=rightEdge),_this3.windowSizer.style.left=newLeft+"px"}else{if(target!==_this3.sizerRight){var oldLeft=_this3.windowSizer.getBoundingClientRect().left-_this3.windowSizerWrapper.getBoundingClientRect().left,oldWidth=_this3.windowSizer.clientWidth,_newLeft=clientX-shiftXLeft-_this3.windowSizerWrapper.getBoundingClientRect().left,_newWidth=oldWidth+(oldLeft-_newLeft);_newLeft<0&&(_newLeft=0);var _minWidth=_this3.windowSizerWrapper.getBoundingClientRect().width/10,_rightEdge=_this3.windowSizer.getBoundingClientRect().right-_this3.windowSizerWrapper.getBoundingClientRect().left-_minWidth;_rightEdge<_newLeft&&(_newLeft=_rightEdge);var rightDiff=_this3.windowSizerWrapper.getBoundingClientRect().right-_this3.windowSizer.getBoundingClientRect().right,_maxWidth=_this3.windowSizerWrapper.clientWidth-rightDiff;return _maxWidth<_newWidth&&(_newWidth=_maxWidth),_newWidth<_minWidth&&(_newWidth=_minWidth),_newLeft=Math.ceil(_newLeft),_newWidth=touch?Math.floor(_newWidth):Math.ceil(_newWidth),_this3.windowSizer.style.left=_newLeft+"px",_this3.windowSizer.style.width=_newWidth+"px",void _this3._redrawDetailedChart(!0)}var newWidth=clientX-_this3.windowSizer.getBoundingClientRect().left+shiftXRight,minWidth=_this3.windowSizerWrapper.clientWidth/10;newWidth<minWidth&&(newWidth=minWidth);var maxWidth=_this3.windowSizerWrapper.clientWidth-(_this3.windowSizer.getBoundingClientRect().left-_this3.windowSizerWrapper.getBoundingClientRect().left);maxWidth<newWidth&&(newWidth=maxWidth),_this3.windowSizer.style.width=newWidth+"px"}_this3._redrawDetailedChart()};if(touch){document.addEventListener("touchend",function onTouchEnd(){document.removeEventListener("touchend",onTouchEnd),document.removeEventListener("touchmove",onMove)}),document.addEventListener("touchmove",onMove)}else{document.addEventListener("mouseup",function onMouseUp(){document.removeEventListener("mouseup",onMouseUp),document.removeEventListener("mousemove",onMove)}),document.addEventListener("mousemove",onMove)}}},{key:"_setDragHandler",value:function(){this.windowSizer.onmousedown=this._sizerMoveHandler.bind(this,!1),this.windowSizer.ontouchstart=this._sizerMoveHandler.bind(this,!0),this.windowSizer.ondragstart=function(){return!1}}},{key:"_setSwitchModeListener",value:function(){var _this4=this;document.querySelector("".concat(this.entryPoint," .switch-mode-btn")).addEventListener("click",function(e){var target=e.target,categoryNames=Array.from(document.querySelectorAll("".concat(_this4.entryPoint," .category-name"))),categoryLabels=Array.from(document.querySelectorAll("".concat(_this4.entryPoint," .category-checkbox"))),chartWrapper=document.querySelector("".concat(_this4.entryPoint," .my-chart-wrapper")),idx=+target.dataset.mode,newIdx=0==idx?1:0;target.setAttribute("data-mode",newIdx),target.innerText="Switch to ".concat(["Day Mode","Night Mode"][idx]),idx?(_this4.mode=0,chartWrapper.classList.remove("night"),categoryNames.forEach(function(c){return c.classList.remove("night")}),categoryLabels.forEach(function(c){return c.classList.remove("night")})):(_this4.mode=1,chartWrapper.classList.add("night"),categoryNames.forEach(function(c){return c.classList.add("night")}),categoryLabels.forEach(function(c){return c.classList.add("night")})),_this4._redrawDetailedChart()})}},{key:"_windowToCanvas",value:function(canvas,x,y){var canvasBox=canvas.getBoundingClientRect();return{x:x-Math.ceil(canvasBox.left),y:y-Math.ceil(canvasBox.top)}}},{key:"_detailedInfoHandler",value:function(canvas,options,event){var clientX=isNaN(event.clientX)?event.touches[0].clientX:event.clientX,clientY=isNaN(event.clientY)?event.touches[0].clientY:event.clientY,coords=this._windowToCanvas(canvas,clientX,clientY),drawData={yStart:(options.offsetY||10)+.2*canvas.clientHeight,yEnd:canvas.clientHeight};drawData.x=coords.x;var activeLines=this._getActiveLinesFromCheckBoxes();if(this.coordsValuesAccordance["".concat(coords.x,"-0")]){var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=activeLines.entries()[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var _step3$value=_slicedToArray(_step3.value,2),idx=_step3$value[0];drawData[_step3$value[1]]=this.coordsValuesAccordance["".concat(coords.x,"-").concat(idx)]}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}this._redrawDetailedChart(!1,drawData),this.lastDetailedInfoData=drawData}else if(this.lastDetailedInfoData){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=activeLines.entries()[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var _step4$value=_slicedToArray(_step4.value,2);idx=_step4$value[0];drawData[_step4$value[1]]=this.coordsValuesAccordance["".concat(this.lastDetailedInfoData.x,"-").concat(idx)]}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}this._redrawDetailedChart(!1,drawData)}}},{key:"_setDetailedInfoListener",value:function(canvas,options){var _this5=this;canvas.addEventListener("mousemove",this._detailedInfoHandler.bind(this,canvas,options)),canvas.addEventListener("touchmove",this._detailedInfoHandler.bind(this,canvas,options)),canvas.addEventListener("touchstart",this._detailedInfoHandler.bind(this,canvas,options)),canvas.addEventListener("touchend",function(e){canvas.ontouchend=null,_this5.lastDetailedInfoData=null,_this5._redrawDetailedChart()}),canvas.addEventListener("mouseout",function(){canvas.onmouseout=null,_this5.lastDetailedInfoData=null,_this5._redrawDetailedChart()})}},{key:"_drawDetailedInfo",value:function(ctx,drawData,options){var xRightEdge=options.chartWidth+options.offsetX-drawData.x,xLeftEdge=drawData.x-options.offsetX;if(0<=xRightEdge&&0<=xLeftEdge){options.circleFillColor||this.colors.white;this._drawValuesLine(ctx,drawData,options);for(var activeLines=this._getActiveLinesFromCheckBoxes(),idx=0;idx<activeLines.length;idx++)if(drawData[activeLines[idx]]){var strokeColor=this.chartData.colors[activeLines[idx]],x=drawData[activeLines[idx]].x,y=drawData[activeLines[idx]].y;this._drawValuePoint(ctx,strokeColor,x,y,options)}this._drawInfoWindow(ctx,drawData,options)}}},{key:"_drawInfoWindow",value:function(ctx,drawData,options){var activeLines=this._getActiveLinesFromCheckBoxes(),yValuesLength=0,xWidth=105,_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=activeLines[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){yValuesLength+=drawData[_step5.value].yValue.toString().length}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorNormalCompletion5||null==_iterator5.return||_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}8<yValuesLength&&(xWidth+=5*(yValuesLength-8));var xStart=drawData.x-10,yStart=drawData.yStart,xLack=xStart+xWidth-(options.chartWidth-1);0<xLack&&(xStart-=xLack);var windowColor=options.dayMode.windowColor,borderWindowColor=options.dayMode.borderWindowColor;this.mode&&(windowColor=options.nightMode.windowColor,borderWindowColor=options.nightMode.borderWindowColor),this._roundRect(ctx,xStart,yStart,xWidth,65,5,windowColor,borderWindowColor),this._drawInfoText(ctx,_objectSpread({},drawData,{xStart:xStart}),options)}},{key:"_roundRect",value:function(ctx,x,y,width,height,radius,windowColor,borderWindowColor){if(void 0===radius&&(radius=5),"number"==typeof radius)radius={tl:radius,tr:radius,br:radius,bl:radius};else{var defaultRadius={tl:0,tr:0,br:0,bl:0};for(var side in defaultRadius)radius[side]=radius[side]||defaultRadius[side]}ctx.save(),ctx.fillStyle=windowColor,ctx.strokeStyle=borderWindowColor,ctx.lineWidth=1,ctx.beginPath(),ctx.moveTo(x+radius.tl,y),ctx.lineTo(x+width-radius.tr,y),ctx.quadraticCurveTo(x+width,y,x+width,y+radius.tr),ctx.lineTo(x+width,y+height-radius.br),ctx.quadraticCurveTo(x+width,y+height,x+width-radius.br,y+height),ctx.lineTo(x+radius.bl,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-radius.bl),ctx.lineTo(x,y+radius.tl),ctx.quadraticCurveTo(x,y,x+radius.tl,y),ctx.closePath(),ctx.stroke(),ctx.fill(),ctx.restore()}},{key:"_drawInfoText",value:function(ctx,drawData,options){var activeLines=this._getActiveLinesFromCheckBoxes();if(activeLines.length&&drawData[activeLines[0]]){var date=this._getRepresentationDate(drawData[activeLines[0]].xValue,!0),shiftX=0,xStart=drawData.xStart,yStart=drawData.yStart;ctx.save(),ctx.font="bold 12px Verdana";var fillStyle=options.dayMode.dateInfoColor;this.mode&&(fillStyle=options.nightMode.dateInfoColor),ctx.fillStyle=fillStyle,ctx.fillText(date,xStart+10,yStart+20),ctx.restore();var colors=this.chartData.colors,names=this.chartData.names,_iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=activeLines[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var line=_step6.value;this._drawValueInfo(ctx,xStart,yStart,shiftX,20,colors[line],drawData[line].yValue,names[line]);var yValueLength=drawData[line].yValue.toString().length;shiftX+=50,4<yValueLength&&(shiftX+=5*(yValueLength-4))}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorNormalCompletion6||null==_iterator6.return||_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}}}},{key:"_drawValueInfo",value:function(ctx,xStart,yStart,shiftX,shiftY,color,value,text){ctx.save();var valueLength=value.toString().length,font="bold 14px Verdana";4<valueLength&&(font="bold ".concat(14-1*(valueLength-4),"px Verdana"));ctx.font=font,ctx.fillStyle=color,ctx.fillText(value,xStart+10+shiftX,yStart+shiftY+25),ctx.font="bold 9px Verdana",ctx.fillText(text,xStart+10+shiftX,yStart+shiftY+38),ctx.restore()}},{key:"_drawValuePoint",value:function(ctx,strokeColor,x,y,options){ctx.save(),ctx.beginPath(),ctx.strokeStyle=strokeColor,ctx.lineWidth=2;var circleFillColor=options.dayMode.circleFillColor;this.mode&&(circleFillColor=options.nightMode.circleFillColor),ctx.fillStyle=circleFillColor,options.chartWidth-1<=x+3?ctx.arc(x-6,y-3,6,0,2*Math.PI):ctx.arc(x,y,6,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.restore()}},{key:"_drawValuesLine",value:function(ctx,drawData,options){ctx.save(),ctx.beginPath(),ctx.moveTo(drawData.x,drawData.yStart),ctx.lineTo(drawData.x,drawData.yEnd),ctx.lineWidth=2;var strokeStyle=options.dayMode.lineValuesColor;this.mode&&(strokeStyle=options.nightMode.lineValuesColor),ctx.strokeStyle=strokeStyle,ctx.stroke(),ctx.restore()}},{key:"_initHTMLMarkup",get:function(){return'\n            <div class="my-chart-wrapper">\n            <button class="switch-mode-btn" data-mode="0">Switch to Night Mode</button>\n            <div class="charts-container">\n                <div class="detailed-chart-container"> \n                    <canvas class="detailed-chart" width="'.concat(this.chartDrawingOptions.chartWidth,'" height="').concat(this.chartDrawingOptions.chartHeight,'"></canvas>\n                </div>\n                <div class="ruler-container">\n                    <canvas class="chart" width="').concat(this.generalChartDrawingOptions.chartWidth,'" height="').concat(this.generalChartDrawingOptions.chartHeight,'"></canvas>\n                    <div class="window-sizer-wrapper">\n                        <div class="window-sizer">\n                            <div class="sizer sizer-left"></div>\n                            <div class="sizer sizer-right"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="checkboxes-container">\n                <label class="category-checkbox">\n                    <span class="category-name"></span>\n                    <input type="checkbox" name="checkbox1" checked>\n                    <span class="checkmark"></span>\n                </label>\n                <label class="category-checkbox">\n                    <span class="category-name"></span>\n                    <input type="checkbox" name="checkbox2" checked>\n                    <span class="checkmark"></span>\n                </label>\n            </div>\n            </div>\n            ')}}]),Chart}(),ChartsInitalizer=function(){function ChartsInitalizer(){_classCallCheck(this,ChartsInitalizer),this.oldWidth=0,this.width=0,this.timeOutTime=100,this.chartsData=null}return _createClass(ChartsInitalizer,[{key:"startUp",value:function(){var _this6=this;fetch("./data/chart_data.json").then(function(res){return res.json()}).then(function(chartsData){_this6.chartsData=chartsData,_this6._setResizeEvent(),_this6._resizeEvent()})}},{key:"_setResizeEvent",value:function(){window.onresize=this._resizeEvent.bind(this,this.chartsData)}},{key:"_resizeEvent",value:function(){setTimeout(this._timeOutResizer.bind(this),this.timeOutTime)}},{key:"_timeOutResizer",value:function(){var offsetX;if(this.width=document.body.offsetWidth,80,offsetX=500<this.width?(this.width=500,40):(this.width-=20,10),this.width!==this.oldWidth){var initChartData={chartDrawingOptions:{offsetX:offsetX,offsetY:80,chartWidth:this.width,chartHeight:this.width},generalChartDrawingOptions:{chartWidth:this.width,chartHeight:50,detailedChart:!1},chartName:{title:"My Chart",font:"bold 16px Verdana",dayMode:{fontColor:"#000000"},nightMode:{fontColor:"#FFFFFF"}},axis:{fontColor:"#96A2AA",axisColor:"#DFE6EB",font:"10px Verdana"},detailedInfo:{dayMode:{lineValuesColor:"#DFE6EB",circleFillColor:"#FFFFFF",dateInfoColor:"#000000",windowColor:"#FFFFFF",borderWindowColor:"#E6ECF0"},nightMode:{lineValuesColor:"#96A2AA",circleFillColor:"#242F3E",dateInfoColor:"#FFFFFF",windowColor:"#242F3E",borderWindowColor:"#000000"}}},app=document.getElementById("app"),_iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=this.chartsData.entries()[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var _step7$value=_slicedToArray(_step7.value,2),idx=_step7$value[0],chartData=_step7$value[1],entryPointId="telegram-chart-".concat(idx),entryPoint="#"+entryPointId,chartNode=document.createElement("div");chartNode.id=entryPointId,app.appendChild(chartNode),initChartData.chartData=chartData,initChartData.entryPoint=entryPoint,new Chart(initChartData).startUp()}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{_iteratorNormalCompletion7||null==_iterator7.return||_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}this.oldWidth=this.width}}}]),ChartsInitalizer}();(new ChartsInitalizer).startUp();